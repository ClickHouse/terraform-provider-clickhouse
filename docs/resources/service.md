---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "clickhouse_service Resource - clickhouse"
subcategory: ""
description: |-
  You can use the clickhouse_service resource to deploy ClickHouse cloud instances on supported cloud providers.
  Known limitations:
  If you create a service with warehouse_id set and then remove warehouse_id attribute completely, the provider won't detect the change. If you want to make a secondary service become primary, remove the warehouse_id and taint it before applying.If you create a service with readonly flag set to true and then remove readonly flag completely, the provider won't detect the change. If you want to make a secondary service read write, explicitly set the readonly flag to false.
---

# clickhouse_service (Resource)

You can use the *clickhouse_service* resource to deploy ClickHouse cloud instances on supported cloud providers.

Known limitations:

- If you create a service with `warehouse_id` set and then remove `warehouse_id` attribute completely, the provider won't detect the change. If you want to make a secondary service become primary, remove the `warehouse_id` and taint it before applying.
- If you create a service with `readonly` flag set to true and then remove `readonly` flag completely, the provider won't detect the change. If you want to make a secondary service read write, explicitly set the `readonly` flag to false.

## Example Usage

```terraform
resource "clickhouse_service" "service" {
  name           = "My Service"
  cloud_provider = "aws"
  region         = "us-east-1"
  idle_scaling   = true

  ip_access = [
    {
      source      = "192.168.2.63"
      description = "Test IP"
    }
  ]

  min_total_memory_gb  = 24
  max_total_memory_gb  = 360
  idle_timeout_minutes = 5

  password_hash  = "n4bQgYhMfWWaL+qgxVrQFaO/TxsrC4Is0V1sFbDwCgg=" # base64 encoded sha256 hash of "test"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `cloud_provider` (String) Cloud provider ('aws', 'gcp', or 'azure') in which the service is deployed in.
- `ip_access` (Attributes List) List of IP addresses allowed to access the service. (see [below for nested schema](#nestedatt--ip_access))
- `name` (String) User defined identifier for the service.
- `region` (String) Region within the cloud provider in which the service is deployed in.

### Optional

- `backup_configuration` (Attributes) Configuration of service backup settings. (see [below for nested schema](#nestedatt--backup_configuration))
- `byoc_id` (String) BYOC ID related to the cloud provider account you want to create this service into.
- `double_sha1_password_hash` (String, Sensitive) Double SHA1 hash of password for connecting with the MySQL protocol. Cannot be specified if `password` is specified.
- `encryption_assumed_role_identifier` (String) Custom role identifier ARN.
- `encryption_key` (String) Custom encryption key ARN.
- `endpoints` (Attributes) Allow to enable and configure additional endpoints (read protocols) to expose on the ClickHouse service. (see [below for nested schema](#nestedatt--endpoints))
- `idle_scaling` (Boolean) When set to true the service is allowed to scale down to zero when idle.
- `idle_timeout_minutes` (Number) Set minimum idling timeout (in minutes). Must be greater than or equal to 5 minutes. Must be set if idle_scaling is enabled.
- `max_replica_memory_gb` (Number) Maximum memory of a single replica during auto-scaling in Gb. Must be a multiple of 8. `max_replica_memory_gb` x `num_replicas` (default 3) must be lower than 360 for non paid services or 720 for paid services.
- `max_total_memory_gb` (Number, Deprecated) Maximum total memory of all workers during auto-scaling in Gb. Must be a multiple of 12 and lower than 360 for non paid services or 720 for paid services.
- `min_replica_memory_gb` (Number) Minimum memory of a single replica during auto-scaling in Gb. Must be a multiple of 8. `min_replica_memory_gb` x `num_replicas` (default 3) must be lower than 360 for non paid services or 720 for paid services.
- `min_total_memory_gb` (Number, Deprecated) Minimum total memory of all workers during auto-scaling in Gb. Must be a multiple of 12 and greater than 24.
- `num_replicas` (Number) Number of replicas for the service. Must be between 3 and 20. Contact support to enable this feature.
- `password` (String, Sensitive) Password for the default user. One of either `password` or `password_hash` must be specified.
- `password_hash` (String, Sensitive) SHA256 hash of password for the default user. One of either `password` or `password_hash` must be specified.
- `query_api_endpoints` (Attributes) Configuration of the query API endpoints feature. (see [below for nested schema](#nestedatt--query_api_endpoints))
- `readonly` (Boolean) Indicates if this service should be read only. Only allowed for secondary services, those which share data with another service (i.e. when `warehouse_id` field is set).
- `release_channel` (String) Release channel to use for this service. Either 'default' or 'fast'. Switching from 'fast' to 'default' release channel is not supported.
- `tier` (String) Tier of the service: 'development', 'production'. Required for organizations using the Legacy ClickHouse Cloud Tiers, must be omitted for organizations using the new ClickHouse Cloud Tiers.
- `transparent_data_encryption` (Attributes) Configuration of the Transparent Data Encryption (TDE) feature. Requires an organization with the Enterprise plan. (see [below for nested schema](#nestedatt--transparent_data_encryption))
- `warehouse_id` (String) ID of the warehouse to share the data with. Must be in the same cloud and region.

### Read-Only

- `iam_role` (String) IAM role used for accessing objects in s3.
- `id` (String) ID of the created service. Generated by ClickHouse Cloud.
- `is_primary` (Boolean) If true, it indicates this is a primary service using its own data. If false it means this service is a secondary service, thus using data from a warehouse.
- `private_endpoint_config` (Attributes) Service config for private endpoints (see [below for nested schema](#nestedatt--private_endpoint_config))

<a id="nestedatt--ip_access"></a>
### Nested Schema for `ip_access`

Required:

- `description` (String) Description of the IP address.
- `source` (String) IP address allowed to access the service. In case you want to set the ip_access to anywhere you should set source to 0.0.0.0/0


<a id="nestedatt--backup_configuration"></a>
### Nested Schema for `backup_configuration`

Optional:

- `backup_period_in_hours` (Number) Interval in hours between each backup.
- `backup_retention_period_in_hours` (Number) How long in hours to keep a backup before deleting it.
- `backup_start_time` (String) Time of the day in UTC that indicates the start time of a 2 hours window to be used for backup. If set, backup_period_in_hours must be null and backups are created once a day.


<a id="nestedatt--endpoints"></a>
### Nested Schema for `endpoints`

Optional:

- `https` (Attributes) (see [below for nested schema](#nestedatt--endpoints--https))
- `mysql` (Attributes) (see [below for nested schema](#nestedatt--endpoints--mysql))
- `nativesecure` (Attributes) (see [below for nested schema](#nestedatt--endpoints--nativesecure))

<a id="nestedatt--endpoints--https"></a>
### Nested Schema for `endpoints.https`

Read-Only:

- `host` (String) Endpoint host.
- `port` (Number) Endpoint port.


<a id="nestedatt--endpoints--mysql"></a>
### Nested Schema for `endpoints.mysql`

Required:

- `enabled` (Boolean) Wether to enable the mysql endpoint or not.

Read-Only:

- `host` (String) Endpoint host.
- `port` (Number) Endpoint port.


<a id="nestedatt--endpoints--nativesecure"></a>
### Nested Schema for `endpoints.nativesecure`

Read-Only:

- `host` (String) Endpoint host.
- `port` (Number) Endpoint port.



<a id="nestedatt--query_api_endpoints"></a>
### Nested Schema for `query_api_endpoints`

Required:

- `api_key_ids` (List of String) The UUIDs of the API Keys to grant access to the query API.
- `roles` (List of String) The Database role that will be used to run the query.

Optional:

- `allowed_origins` (String) Comma separated list of domain names to be allowed cross-origin resource sharing (CORS) access to the query API. Leave this field empty to restrict access to backend servers only


<a id="nestedatt--transparent_data_encryption"></a>
### Nested Schema for `transparent_data_encryption`

Required:

- `enabled` (Boolean) If true, TDE is enabled for the service.

Optional:

- `key_id` (String) ID of the Encryption key to use for data encryption. Must be an ARN for AWS services or a Key Resource Path for GCP services.


<a id="nestedatt--private_endpoint_config"></a>
### Nested Schema for `private_endpoint_config`

Read-Only:

- `endpoint_service_id` (String) Unique identifier of the interface endpoint you created in your VPC with the AWS(Service Name) or GCP(Target Service) resource.
- `private_dns_hostname` (String) Private DNS Hostname of the VPC you created.

## Import

Import is supported using the following syntax:

```shell
# Services can be imported by specifying the UUID.
terraform import clickhouse_service.example xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```
